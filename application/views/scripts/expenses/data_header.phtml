<?php
global $st_lang;
?>
<script type="text/javascript" src="/node_modules/taggle/src/taggle.js"></script>
<script type="text/javascript" language="text/javascript">
	var deleteUrl = "<?php echo Zend_Registry::get('config')->moxie->settings->url; ?>/expenses/delete/id/";
    var deleteMessage = "<?php echo $st_lang['expenses_delete_message']; ?>";
	var getyearUrl = "<?php echo Zend_Registry::get('config')->moxie->settings->url; ?>/expenses/year";
	var settingsMonth = <?php echo (isset($this->month) ? $this->month : date('n')); ?>;
	var settingsYear = <?php echo $this->year; ?>;
	var getmonthUrl = "<?php echo Zend_Registry::get('config')->moxie->settings->url; ?>/expenses/month/month/"+settingsMonth+"/year/"+settingsYear;
	var tagList = [<?php if(!empty($this->tags)) echo "'".implode($this->tags, "','")."'"; ?>];
</script>
<script type="text/javascript" src="/js/expenses/data.js"></script>
<table width=100%>
<?php global $st_lang; ?>
<td align="left"><a href="/expenses/index/month/<?php if ($this->month == 1) echo 12; else echo $this->month-1;?>/year/<?php if ($this->month == 1) echo $this->year-1; else echo $this->year;?>"><div class="moxieicon moxieprevious"></div><span class="moxieprevious"> <?php echo $st_lang['expenses_last_month']; ?></span></a></td>
<td align="center"><span class="moxie_header_date"><?php echo date("M Y", strtotime("01-".$this->month."-".$this->year)); ?></span></td>
<td align="right"><a href="/expenses/index/month/<?php if ($this->month == 12) echo 1; else echo $this->month+1;?>/year/<?php if ($this->month == 12) echo $this->year+1; else echo $this->year;?>"><div class="moxieicon moxienext"></div><span class="moxienext"> <?php echo $st_lang['expenses_next_month']; ?></span></a></td>
</table>
<br>

<div id="form">
<div class="moxie_expenses_form_div" style="float: left">
<?php
$i_expensePK = $this->form->getValue('id');
$checked = ($this->form->getElement('in_sum') == 1) ? "checked": "";
if (isset($i_expensePK)) {
?>
	<form id="login" enctype="application/x-www-form-urlencoded" action="/expenses/update" method="post" class="moxie_form">
	<div>Check/uncheck to show in totals <input type="checkbox" class="my-checkbox" id="<?php echo $i_expensePK; ?>" name="<?php echo $i_expensePK; ?>" onClick="markLine(<?php echo $i_expensePK; ?>);" <?php echo $checked; ?>"/></div>
<?php
	echo $this->form->getElement('user_owner');
	echo $this->form->getElement('id');
	$amount = $this->form->getValue('amount');
}
else {
?>
	<form id="login" enctype="application/x-www-form-urlencoded" action="/expenses/add" method="post" class="moxie_form">
<?php
	$amount = '';
}
?>
<dt id="amount-label"><label for="amount" class="optional"><?php echo $st_lang['expenses_amount']; ?></label></dt>
<dd>
<input type="number" id="amount" name="amount" step="any" placeholder="0,00" value="<?php echo $amount; ?>">
</dd>
<?php
echo $this->form->getElement('note');
?>
<dt id="date-label"><label for="date" class="optional">Fecha</label></dt>
<dd><input type="date" id="date" name="date" value="<?php echo $this->form->getValue('date'); ?>"></dd>
<dt id="category-label"><label for="category" class="optional">Categor√≠a</label></dt>
<dd id="category-element">
<div class='selectBox'>
    <span class='selected'></span>
    <span class='selectArrow'>&#9660</span>
    <div class="selectOptions" >
<?php
$values = $this->form->getElement('category')->getValue();
foreach($this->form->getElement('category') as $key => $option) {
    $selectedSpanId = (!empty($values)) ? $values[0] : null;
	if($key == "options") {
		foreach($option as $key2 => $option2) {
            $selectedSpan = ($selectedSpanId == $key2) ? " selectedSpan" : "";
			echo "<span class='selectOption".$selectedSpan."' value='".$key2."'>".$option2."</span>";
		}
	}
}
?>
</div>
</div>
<input type="hidden" name="category" id="category" value="<?php echo $selectedSpanId; ?>"/>
</dd>
<dt for="form_tags">Tags</dt>
<dd id="form_tags"><div id="tags"></div></dd>
<?php
echo $this->form->getElement('submit');
if(isset($i_expensePK)) {
	echo '<input type="button" class="moxiedelete" value="'.$st_lang['expenses_delete'].'" onclick=\'confirmDelete("' . $i_expensePK . $s_dateGet . '")\'/>';
}
echo '</form>';
?>
</div>
</div>
