<?php
global $st_lang;
$last_month = ($this->month == 1) ? 12 : $this->month-1;
$last_year = ($this->month == 1) ? $this->year-1 : $this->year;
$next_month = ($this->month == 12) ? 1 : $this->month+1;
$next_year = ($this->month == 12) ? $this->year+1 : $this->year;
$current_month_and_year = date("M Y", strtotime("01-".$this->month."-".$this->year));
$last_url = "/expenses/index/month/".$last_month."/year/".$last_year;
$next_url = "/expenses/index/month/".$next_month."/year/".$next_year;
?>
<script type="text/javascript" language="text/javascript">
	var deleteUrl = "<?php echo Zend_Registry::get('config')->moxie->settings->url; ?>/expenses/delete/id/";
    var deleteMessage = "<?php echo $st_lang['expenses_delete_message']; ?>";
	var tagList = [<?php if(!empty($this->tags)) echo "'".implode($this->tags, "','")."'"; ?>];
    var usedTagList = [<?php if(!empty($this->used_tag_list)) echo "'".implode($this->used_tag_list, "','")."'"; ?>];
	var tagsPlaceholder = "<?php echo $st_lang['tags_placeholder']; ?>";
</script>
<script type="text/javascript" src="/js/expenses/data.js"></script>

<?php $this->getHelper('Web')->printHeaderNextLastInterval($last_url, $next_url, $current_month_and_year); ?>

<br>

<div id="form">
<div class="moxie_expenses_form_div moxie_expenses_form_left">
<?php
echo '<h2>'.$st_lang['expenses_header'].'</h2>';
$i_expensePK = $this->form->getValue('id');
$checked = ($this->form->getValue('in_sum') == "1") ? "checked": "";
?>
	<?php if(isset($this->favourites_json) && $this->favourites_json != "[]") { ?>
<!-- <div id="favourites_container">
		<span id="favourites_button">
		<button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored">
			<i class="material-icons" style="background-color: #0b77b7">+</i>
		</button>
		Favoritos
		</span>
		<span id="favourites_list" style="display: none">
			<script type="text/javascript">
				favourite_data = <?php echo $this->favourites_json; ?>;
			</script>
			<form>
				<select id="favourites" name="favourites"><option value=""></option></select>
			</form>
		</span>
	</div>-->
	
	
	<div class="modal fade" tabindex="-1" role="dialog">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">Favoritos</h4>
	      </div>
	      <div class="modal-body">
			<span id="favourites_list" style="display: none">
				<script type="text/javascript">
					favourite_data = <?php echo $this->favourites_json; ?>;
				</script>
				<form>
					<select id="favourites" name="favourites"><option value=""></option></select>
				</form>
			</span>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary">Save changes</button>
	      </div>
	    </div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
	</div><!-- /.modal -->
	<?php } ?>
	<form id="login" enctype="application/x-www-form-urlencoded" action="<?php echo $this->form->getAction(); ?>" method="<?php echo $this->form->getMethod(); ?>" class="moxie_form">
	<?php
	if (isset($i_expensePK)) {
	?>
		<input type="hidden" id="id" name="id" value="<?php echo $i_expensePK; ?>"/>
	<?php
	}
	//echo $this->form->getElement('id');
	echo $this->form->getElement('amount');
	echo $this->form->getElement('note');
	echo $this->form->getElement('date');
	echo $this->form->getElement('category');
	?>

	<dt for="form_tags">Tags</dt>
	<dd id="form_tags" class="dd_taggle_list">
		<div id="tags" class="div_taggle_list"></div>
	</dd>
	<?php
	echo $this->form->getElement('in_sum');
	echo $this->form->getElement('favourite');
	echo $this->form->getElement('submit');
	if(isset($i_expensePK)) {
		echo '<input type="button" class="moxiedelete" value="'.$st_lang['expenses_delete'].'" onclick=\'confirmDelete("' . $i_expensePK . '")\'/>';
	}
	?>
	</form>
</div>
<div id="search_box" class="moxie_expenses_form_div moxie_expenses_form_right">
<?php
echo $this->partial('common/filter.phtml', array('search_form' => $this->search_form));
?>
</div>
</div>
